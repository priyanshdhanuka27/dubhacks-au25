{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{searchService}from'../../services/searchService';// import { RAGResponse } from '../../types';\nimport'./SearchComponents.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const ConversationalSearch=_ref=>{let{onEventSelect,className=''}=_ref;const[messages,setMessages]=useState([{id:'welcome',type:'assistant',content:'Hi! I can help you find events using natural language. Try asking me something like \"Find music concerts this weekend\" or \"What tech events are happening in Seattle?\"',timestamp:new Date()}]);const[inputValue,setInputValue]=useState('');const[isLoading,setIsLoading]=useState(false);const[sessionId,setSessionId]=useState();const messagesEndRef=useRef(null);const inputRef=useRef(null);const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};useEffect(()=>{scrollToBottom();},[messages]);const handleSubmit=async e=>{e.preventDefault();if(!inputValue.trim()||isLoading){return;}const userMessage={id:\"user-\".concat(Date.now()),type:'user',content:inputValue.trim(),timestamp:new Date()};setMessages(prev=>[...prev,userMessage]);setInputValue('');setIsLoading(true);try{const response=await searchService.performConversationalSearch({query:userMessage.content,sessionId});const assistantMessage={id:\"assistant-\".concat(Date.now()),type:'assistant',content:response.answer,timestamp:new Date(),sources:response.sources};setMessages(prev=>[...prev,assistantMessage]);if(response.sessionId){setSessionId(response.sessionId);}}catch(error){const errorMessage={id:\"error-\".concat(Date.now()),type:'assistant',content:\"I'm sorry, I encountered an error: \".concat(error.message,\". Please try rephrasing your question.\"),timestamp:new Date()};setMessages(prev=>[...prev,errorMessage]);}finally{var _inputRef$current;setIsLoading(false);(_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.focus();}};const handleClearChat=()=>{setMessages([{id:'welcome',type:'assistant',content:'Hi! I can help you find events using natural language. Try asking me something like \"Find music concerts this weekend\" or \"What tech events are happening in Seattle?\"',timestamp:new Date()}]);setSessionId(undefined);};const handleSourceClick=source=>{if(source.url&&onEventSelect){// Extract event ID from URL if possible\nconst eventIdMatch=source.url.match(/events\\/([^/]+)/);if(eventIdMatch){onEventSelect(eventIdMatch[1]);}}};const suggestedQueries=[\"Find music concerts this weekend\",\"What tech events are happening in Seattle?\",\"Show me free events near downtown\",\"Any food festivals coming up?\",\"Find networking events for entrepreneurs\"];return/*#__PURE__*/_jsxs(\"div\",{className:\"conversational-search \".concat(className),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Ask me about events\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleClearChat,className:\"clear-chat-btn\",title:\"Clear conversation\",children:\"\\uD83D\\uDDD1\\uFE0F\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages\",children:[messages.map(message=>/*#__PURE__*/_jsxs(\"div\",{className:\"message \".concat(message.type),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"message-content\",children:[/*#__PURE__*/_jsx(\"p\",{children:message.content}),message.sources&&message.sources.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"message-sources\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Related Events:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"sources-list\",children:message.sources.map((source,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"source-item\",onClick:()=>handleSourceClick(source),children:[/*#__PURE__*/_jsx(\"div\",{className:\"source-title\",children:source.title}),/*#__PURE__*/_jsx(\"div\",{className:\"source-excerpt\",children:source.excerpt}),/*#__PURE__*/_jsxs(\"div\",{className:\"source-score\",children:[\"Relevance: \",Math.round(source.relevanceScore*100),\"%\"]})]},index))})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"message-timestamp\",children:message.timestamp.toLocaleTimeString()})]},message.id)),isLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"message assistant loading\",children:/*#__PURE__*/_jsx(\"div\",{className:\"message-content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"typing-indicator\",children:[/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{})]})})}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),messages.length===1&&/*#__PURE__*/_jsxs(\"div\",{className:\"suggested-queries\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Try asking:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"suggestions\",children:suggestedQueries.map((query,index)=>/*#__PURE__*/_jsx(\"button\",{className:\"suggestion-btn\",onClick:()=>setInputValue(query),children:query},index))})]}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,className:\"chat-input-form\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"input-container\",children:[/*#__PURE__*/_jsx(\"input\",{ref:inputRef,type:\"text\",value:inputValue,onChange:e=>setInputValue(e.target.value),placeholder:\"Ask me about events...\",disabled:isLoading,className:\"chat-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!inputValue.trim()||isLoading,className:\"send-btn\",children:isLoading?'⏳':'➤'})]})})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}